---
description: "テスト駆動開発"
---

# TDD (Test-Driven Development) ワークフロー

このプロジェクトでは、**すべての実装において TDD を厳格に適用**することを必須とします。

## 適用範囲

以下の手順は**すべてのコード変更**（新機能、バグ修正、リファクタリング、コード分割）に適用されます。

## 実装前必須チェックリスト

**ANY コード変更作業開始前の必須条件**:

- [ ] 要件分析対話完了
- [ ] TODO リスト作成済み
- [ ] テスト設計書作成済み（テスト項目を TODO 形式で提示）
- [ ] 失敗テスト作成済み（Red phase）
- [ ] 最小限の実装完了（Green phase）
- [ ] リファクタリング完了（Refactor phase）

## 禁止事項

- ❌ 対話なしでの直接実装
- ❌ テストなしでのコード変更
- ❌ TODO リストなしでの作業開始
- ❌ 要件確認なしでの実装

## TDD サイクル

1. **Red**: 失敗するテストを最初に書く
2. **Green**: テストを通すための最小限のコードを書く
3. **Refactor**: テストを維持しながらコードを改善する

## TODO リストベース実装

実装前に常に TODO リストを作成し、以下の手順に従う：

1. **要件分析**: 初期要件から TODO リストを生成
2. **段階的詳細化**: 各 TODO アイテムの詳細を明確化
3. **テスト設計書**: テスト項目を TODO 形式で提示してからテストを作成
   - **保存先**: `docs/test_design/` ディレクトリに `YYYY-MM-DD_機能名.md` として保存
   - **設計書作成後**: 設計書のレビューを依頼し、承認を得てから実装開始
4. **テストカテゴリ分類**:
   - `[ ] Happy Path`: 基本機能の検証
   - `[ ] Error Cases`: エラー処理シナリオ
   - `[ ] Edge Cases`: 境界条件
   - `[ ] Integration`: コンポーネント間の相互作用

## 実装フロー

```text
要件 → TODOリスト → テスト設計書 → 設計書レビュー → 失敗テスト → 最小実装 → リファクタリング → 次のTODO
```

## 相談フェーズ対話

複雑な実装や不明確な要件に対する段階的詳細化アプローチ：

1. **要件分析対話**: 「どのような...？」で詳細を明確化
2. **既存コード分析**: 実装前に既存パターンを学習
3. **シナリオ展開**: ハッピーパス → エラーケース → エッジケース
4. **段階的詳細化**: 目的 → 前提条件 → アクション → 期待結果

## 実装ベストプラクティス

### 型安全性

- モダンな Python 型ヒント（`list[T]` を `List[T]` の代わりに使用）
- 必要に応じてキャストするが、型ガード（`isinstance`）を優先
- Union 型や None チェックでオプショナル型を明示的に処理
- 不変性を持つ構造化データには NamedTuple を使用
- Python 3.9 互換性のため `|` 構文ではなく Union 型を使用

### テストコードの日本語コメント

- テストコードのみ日本語コメントを使用
- テストの意図や背景を日本語で明確に記述
- テストケースの説明は日本語で記述し、理解しやすくする

## 実装チェックポイント

### 各フェーズでの確認事項

**Red Phase**:

- [ ] テストが確実に失敗することを確認
- [ ] テストの意図が明確
- [ ] テストがシンプルで理解しやすい

**Green Phase**:

- [ ] テストが通る最小限のコードを実装
- [ ] 過度に複雑な実装を避ける
- [ ] 次のリファクタリングで改善できる状態にする

**Refactor Phase**:

- [ ] テストが引き続き通ることを確認
- [ ] コードの可読性向上
- [ ] 重複の除去
- [ ] 設計の改善

### 完了確認

- [ ] すべてのテストが通る
- [ ] 型チェック（mypy）が通る
- [ ] リンター（ruff）が通る
- [ ] 実装が要件を満たしている

## 注意事項

- 実装は必ず**テストファースト**で行う
- 一度に一つの機能に集中する
- 常に TODO リストを更新し、進捗を追跡する
- 不明な点があれば実装前に必ず確認する
- リファクタリングは小さなステップで行う

以上を理解したらユーザーにヒアリングを始めてください。
