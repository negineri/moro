# EPGStation タイトルフィルター機能 - 要件定義

## 概要

EPGStationサブコマンドの録画一覧表示機能（`moro epgstation list`）に、番組タイトルによるフィルタリング機能を追加する。

## ユーザーストーリー

### 主要機能

**US-001: 基本タイトルフィルター**

- **As a** ユーザー
- **I want to** 録画一覧を番組タイトルで絞り込める
- **So that** 特定の番組を素早く見つけられる

**US-002: 大文字・小文字非区別検索**

- **As a** ユーザー
- **I want to** 大文字・小文字を気にせずに検索できる
- **So that** より柔軟に番組を検索できる

**US-003: 正規表現サポート**

- **As a** 上級ユーザー
- **I want to** 正規表現パターンで検索できる
- **So that** 複雑な検索条件を指定できる

### 統合要件

**US-004: 既存オプション併用**

- **As a** ユーザー
- **I want to** フィルター機能を既存の--limit、--formatオプションと併用できる
- **So that** 既存のワークフローを維持できる

## EARS記法による詳細要件

### 基本フィルタリング

```
WHEN ユーザーがepgstation listコマンドを実行する際
GIVEN --titleオプションでフィルター条件を指定した場合
THEN システムは番組タイトルに指定文字列を含む録画のみを表示する
AND フィルタリングは大文字・小文字を区別しない

WHILE ユーザーがタイトルフィルターを使用している間
THE SYSTEM SHALL 既存の--limit、--formatオプションと併用可能にする
AND フィルタリング後の件数に対してlimitを適用する
```

### 正規表現サポート

```
WHERE ユーザーが--regexオプションを指定した場合
IS タイトルフィルターが正規表現として解釈される
THE SYSTEM SHALL 有効な正規表現パターンでマッチングを実行する
AND 無効な正規表現の場合は適切なエラーメッセージを表示する

WHEN 正規表現エラーが発生した際
GIVEN 無効な正規表現パターンが入力された場合
THEN システムは分かりやすいエラーメッセージを表示する
AND プログラムは適切に終了する
```

### パフォーマンス要件

```
WHILE システムがタイトルフィルタリングを実行している間
THE SYSTEM SHALL 1000件の録画データを1秒以内で処理する
AND メモリ使用量の大幅な増加を避ける

WHERE 大量データ処理時に
IS フィルタリング処理が実行される場合
THE SYSTEM SHALL レスポンス性を維持する
AND 適切なログ出力を行う
```

### エラーハンドリング

```
WHEN フィルタリング処理中にエラーが発生した際
GIVEN 予期しない例外が発生した場合
THEN システムは詳細なエラー情報をログに記録する
AND ユーザーには分かりやすいエラーメッセージを表示する

WHERE フィルター結果が空の場合
IS マッチする録画が見つからない状況で
THE SYSTEM SHALL 適切な「結果なし」メッセージを表示する
AND 空の結果でもエラーとして扱わない
```

## 受け入れ基準

### AC-001: 基本フィルタリング

- [ ] `--title "番組名"` オプションで部分マッチ検索ができる
- [ ] 大文字・小文字の違いを無視してマッチする
- [ ] マッチした録画のみが表示される
- [ ] フィルター結果が0件でも正常に動作する

### AC-002: 正規表現サポート

- [ ] `--regex` フラグで正規表現モードになる
- [ ] 有効な正規表現パターンでマッチングできる
- [ ] 無効な正規表現には適切なエラーメッセージを表示
- [ ] 正規表現モードでは大文字・小文字を区別する（デフォルト）

### AC-003: 既存機能との統合

- [ ] `--limit` オプションがフィルター後の結果に適用される
- [ ] `--format table/json` が正常に動作する
- [ ] エラーハンドリングが既存パターンと一貫している
- [ ] 新機能追加前後で既存テストが通る

### AC-004: パフォーマンス

- [ ] 1000件のデータを1秒以内で処理
- [ ] メモリ使用量が大幅に増加しない
- [ ] 処理時間がデータ件数に対してO(n)程度

### AC-005: ユーザビリティ

- [ ] ヘルプメッセージに新オプションが表示される
- [ ] エラーメッセージが分かりやすい
- [ ] 使用例がドキュメントに記載される

## 非機能要件

### セキュリティ

- 正規表現DoS（ReDoS）攻撃の防止
- 入力値の適切なサニタイズ

### 保守性

- 既存のアーキテクチャパターンに準拠
- テストカバレッジの維持
- ログ出力の一貫性

### 互換性

- 既存のCLIインターフェースとの下位互換性
- 既存の設定ファイルに影響を与えない
