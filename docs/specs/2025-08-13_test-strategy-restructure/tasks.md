# ãƒ†ã‚¹ãƒˆæˆ¦ç•¥å†æ§‹ç¯‰ - å®Ÿè£…ã‚¿ã‚¹ã‚¯

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: moro - ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ãƒ¢ãƒãƒªã‚¹æº–æ‹ ãƒ†ã‚¹ãƒˆå®Ÿè£…
**ä½œæˆæ—¥**: 2025-08-13
**å®Ÿè£…æˆ¦ç•¥**: æ®µéšçš„ç§»è¡Œãƒ»ãƒªã‚¹ã‚¯æœ€å°åŒ–ãƒ»å“è³ªè‡ªå‹•åŒ–

## ğŸ¯ å®Ÿè£…æˆ¦ç•¥æ¦‚è¦

### æ ¸å¿ƒã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

- **æ®µéšçš„ç§»è¡Œ**: æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã‚’åœæ­¢ã•ã›ãªã„æ¼¸é€²çš„å¤‰æ›´
- **ãƒªã‚¹ã‚¯æœ€å°åŒ–**: å„æ®µéšã§ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯èƒ½æ€§ç¢ºä¿
- **å“è³ªè‡ªå‹•åŒ–**: æ§‹é€ å“è³ªç¶­æŒã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯å®Ÿè£…
- **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹**: å®Œå…¨ç‹¬ç«‹å®Ÿè¡Œå¯èƒ½ãªãƒ†ã‚¹ãƒˆæ§‹é€ 

### 3æ®µéšå®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

```mermaid
gantt
    title ãƒ†ã‚¹ãƒˆæˆ¦ç•¥å†æ§‹ç¯‰å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
    dateFormat  YYYY-MM-DD
    section Phase A: åŸºç›¤æ§‹ç¯‰
    æ–°æ§‹é€ ä½œæˆ          :done, phaseA1, 2025-08-13, 2d
    ãƒ„ãƒ¼ãƒ«å°å…¥          :done, phaseA2, after phaseA1, 3d
    å“è³ªã‚²ãƒ¼ãƒˆè¨­å®š      :active, phaseA3, after phaseA2, 2d

    section Phase B: å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ«åˆ†è§£
    ä¾¡å€¤åˆ†æãƒ»åˆ†é¡      :phaseB1, after phaseA3, 2d
    ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆæŠ½å‡º  :phaseB2, after phaseB1, 3d
    ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹åˆ†é›¢    :phaseB3, after phaseB2, 3d
    çµ±åˆãƒ†ã‚¹ãƒˆæœ€å°åŒ–    :phaseB4, after phaseB3, 2d
    ä¸è¦ãƒ†ã‚¹ãƒˆå‰Šé™¤      :phaseB5, after phaseB4, 2d

    section Phase C: å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ¨™æº–åŒ–
    EPGStationç§»è¡Œ      :phaseC1, after phaseB5, 4d
    TODOæœ€é©åŒ–          :phaseC2, after phaseC1, 2d
    CLIå±¤çµ±åˆ           :phaseC3, after phaseC2, 3d
    å“è³ªè‡ªå‹•åŒ–å®Œæˆ      :phaseC4, after phaseC3, 3d
```

## ğŸ“‹ Phase A: åŸºç›¤æ§‹ç¯‰ (Week 1-2)

### ğŸ¯ ç›®æ¨™

æ–°æ§‹é€ ã®åŸºç›¤ç¢ºç«‹ãƒ»ãƒ„ãƒ¼ãƒ«å°å…¥ãƒ»å“è³ªã‚²ãƒ¼ãƒˆè¨­å®š

### âœ… Task A1: æ–°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ

**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜
**æ‰€è¦æ™‚é–“**: 1-2æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:

```bash
# æ–°ãƒ†ã‚¹ãƒˆæ§‹é€ ã®å®Œå…¨ä½œæˆ
mkdir -p tests/unit/modules/{epgstation,fantia,todo,common}
mkdir -p tests/unit/{cli,core}
mkdir -p tests/integration/{cli_to_modules,external_systems,infrastructure}
mkdir -p tests/e2e/{workflows,scenarios}
mkdir -p tests/{factories,contracts}

# å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«README.mdä½œæˆ
echo "# EPGStation Module Unit Tests - å®Œå…¨ç‹¬ç«‹å®Ÿè¡Œ" > tests/unit/modules/epgstation/README.md
echo "# Fantia Module Unit Tests - å®Œå…¨ç‹¬ç«‹å®Ÿè¡Œ" > tests/unit/modules/fantia/README.md
echo "# TODO Module Unit Tests - å®Œå…¨ç‹¬ç«‹å®Ÿè¡Œ" > tests/unit/modules/todo/README.md
echo "# Integration Tests - Cross-module boundaries" > tests/integration/README.md
echo "# E2E Tests - Full user workflows" > tests/e2e/README.md
```

**æˆåŠŸåŸºæº–**:

- [ ] å…¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆå®Œäº†
- [ ] å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç›®çš„æ–‡æ›¸åŒ–
- [ ] æ—¢å­˜testsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã®ä¸¦å­˜ç¢ºèª

### âœ… Task A2: polyfactoryãƒ»é–‹ç™ºãƒ„ãƒ¼ãƒ«å°å…¥

**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜
**æ‰€è¦æ™‚é–“**: 2-3æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:

```bash
# Type-safe testing toolså°å…¥
uv add --dev polyfactory          # factory-boyä»£æ›¿
uv add --dev pytest-xdist         # ä¸¦åˆ—å®Ÿè¡Œ
uv add --dev pytest-benchmark     # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
uv add --dev hypothesis           # Property-based testing
uv add --dev import-linter        # import ãƒ«ãƒ¼ãƒ«ç›£è¦–

# pytestè¨­å®šæ›´æ–°
cat >> pyproject.toml << 'EOF'

[tool.pytest.ini_options]
testpaths = ["tests"]
markers = [
    "unit: Unit tests (module independent, fast)",
    "integration: Integration tests (cross-module, medium)",
    "e2e: End-to-end tests (full workflows, slow)",
    "contract: Contract tests (module boundaries)"
]
addopts = "--strict-markers --strict-config"

# ä¸¦åˆ—å®Ÿè¡Œè¨­å®š
# pytest -m unit -n auto     # å˜ä½“ãƒ†ã‚¹ãƒˆä¸¦åˆ—å®Ÿè¡Œ
# pytest -m integration      # çµ±åˆãƒ†ã‚¹ãƒˆé€æ¬¡å®Ÿè¡Œ
EOF
```

**æˆåŠŸåŸºæº–**:

- [ ] å…¨ãƒ„ãƒ¼ãƒ«æ­£å¸¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
- [ ] pytestè¨­å®šé©ç”¨ç¢ºèª
- [ ] æ—¢å­˜ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã«å½±éŸ¿ãªã—ç¢ºèª

### âœ… Task A3: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹æ€§ç›£è¦–ãƒ„ãƒ¼ãƒ«è¨­å®š

**å„ªå…ˆåº¦**: ğŸŸ¡ é«˜
**æ‰€è¦æ™‚é–“**: 3-4æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:

```toml
# .importlinter.tomlä½œæˆ
[tool.importlinter]
root_packages = ["tests.unit.modules"]

[[tool.importlinter.contracts]]
name = "EPGStation module independence"
type = "forbidden"
source_modules = ["tests.unit.modules.epgstation"]
forbidden_modules = [
    "tests.unit.modules.fantia",
    "tests.unit.modules.todo",
    "moro.modules.fantia",
    "moro.modules.todo"
]

[[tool.importlinter.contracts]]
name = "Fantia module independence"
type = "forbidden"
source_modules = ["tests.unit.modules.fantia"]
forbidden_modules = [
    "tests.unit.modules.epgstation",
    "tests.unit.modules.todo",
    "moro.modules.epgstation",
    "moro.modules.todo"
]

[[tool.importlinter.contracts]]
name = "TODO module independence"
type = "forbidden"
source_modules = ["tests.unit.modules.todo"]
forbidden_modules = [
    "tests.unit.modules.epgstation",
    "tests.unit.modules.fantia",
    "moro.modules.epgstation",
    "moro.modules.fantia"
]
```

```python
# scripts/validate_test_structure.pyä½œæˆ
#!/usr/bin/env python3
"""ãƒ†ã‚¹ãƒˆæ§‹é€ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ"""

import ast
import sys
from pathlib import Path
from typing import List, Set

def check_module_independence() -> bool:
    """å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆã®ç‹¬ç«‹æ€§ãƒã‚§ãƒƒã‚¯"""
    violations = []

    for module_dir in Path("tests/unit/modules").iterdir():
        if not module_dir.is_dir():
            continue

        module_name = module_dir.name
        for test_file in module_dir.glob("**/*.py"):
            violations.extend(_check_file_imports(test_file, module_name))

    if violations:
        print("âŒ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹æ€§é•å:", file=sys.stderr)
        for violation in violations:
            print(f"  {violation}", file=sys.stderr)
        return False

    print("âœ… ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹æ€§: é©åˆ")
    return True

def _check_file_imports(file_path: Path, module_name: str) -> List[str]:
    """ãƒ•ã‚¡ã‚¤ãƒ«ã®importæ–‡ã‚’ãƒã‚§ãƒƒã‚¯"""
    try:
        content = file_path.read_text()
        tree = ast.parse(content)
    except Exception as e:
        return [f"{file_path}: Parse error - {e}"]

    violations = []
    forbidden_patterns = [
        f"moro.modules.{other}"
        for other in ["epgstation", "fantia", "todo"]
        if other != module_name
    ]

    for node in ast.walk(tree):
        if isinstance(node, (ast.Import, ast.ImportFrom)):
            import_name = _get_import_name(node)
            for pattern in forbidden_patterns:
                if import_name and import_name.startswith(pattern):
                    violations.append(f"{file_path}: ç¦æ­¢import - {import_name}")

    return violations

def _get_import_name(node) -> str:
    """importæ–‡ã‹ã‚‰åå‰ã‚’æŠ½å‡º"""
    if isinstance(node, ast.Import):
        return node.names[0].name if node.names else ""
    elif isinstance(node, ast.ImportFrom):
        return node.module or ""
    return ""

if __name__ == "__main__":
    success = check_module_independence()
    sys.exit(0 if success else 1)
```

**æˆåŠŸåŸºæº–**:

- [ ] import-linterè¨­å®šå®Œäº†
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆå‹•ä½œç¢ºèª
- [ ] pre-commit hookè¨­å®š
- [ ] CI/CDçµ±åˆè¨­å®š

### âœ… Task A4: åŸºæœ¬Factoryä½œæˆ

**å„ªå…ˆåº¦**: ğŸŸ¡ é«˜
**æ‰€è¦æ™‚é–“**: 2-3æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:

```python
# tests/factories/common_factories.py
"""å…±é€šFactoryå®šç¾©"""
from polyfactory import BaseFactory
from moro.modules.common import CommonConfig

class CommonConfigFactory(BaseFactory[CommonConfig]):
    __model__ = CommonConfig

    @classmethod
    def user_data_dir(cls) -> str:
        return "/tmp/test_user_data"

    @classmethod
    def user_cache_dir(cls) -> str:
        return "/tmp/test_cache"

    @classmethod
    def working_dir(cls) -> str:
        return "/tmp/test_working"

    @classmethod
    def jobs(cls) -> int:
        return 2
```

```python
# tests/factories/__init__.py
"""Factory exports"""
from .common_factories import CommonConfigFactory

__all__ = ["CommonConfigFactory"]
```

**æˆåŠŸåŸºæº–**:

- [ ] åŸºæœ¬Factoryå‹•ä½œç¢ºèª
- [ ] Type-safeæ€§ç¢ºèª
- [ ] ãƒ†ã‚¹ãƒˆã§ã®ä½¿ç”¨ç¢ºèª

## ğŸ“‹ Phase B: å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ«åˆ†è§£ (Week 3-4)

### ğŸ¯ ç›®æ¨™

test_fantia.py(1,189è¡Œ)ã®å®Œå…¨åˆ†è§£ãƒ»è²¬å‹™åˆ†é›¢ãƒ»ä¸è¦ãƒ†ã‚¹ãƒˆå‰Šé™¤

### âœ… Task B1: æ—¢å­˜ãƒ†ã‚¹ãƒˆä¾¡å€¤åˆ†æãƒ»åˆ†é¡

**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜
**æ‰€è¦æ™‚é–“**: 4-6æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:

```python
# scripts/analyze_fantia_tests.py
"""test_fantia.pyã®ä¾¡å€¤åˆ†æã‚¹ã‚¯ãƒªãƒ—ãƒˆ"""

import ast
import re
from pathlib import Path
from typing import Dict, List, NamedTuple

class TestAnalysis(NamedTuple):
    name: str
    line_count: int
    mock_count: int
    category: str  # domain, usecase, infrastructure, integration, e2e
    value_score: int  # 1-5 (5=æœ€é«˜ä¾¡å€¤)
    keep_decision: str  # keep, refactor, delete

def analyze_fantia_tests() -> List[TestAnalysis]:
    """æ—¢å­˜ãƒ†ã‚¹ãƒˆã®è©³ç´°åˆ†æ"""
    test_file = Path("tests/modules/test_fantia.py")
    content = test_file.read_text()
    tree = ast.parse(content)

    analyses = []
    for node in ast.walk(tree):
        if isinstance(node, ast.FunctionDef) and node.name.startswith("test_"):
            analysis = _analyze_test_function(node, content)
            analyses.append(analysis)

    return analyses

def _analyze_test_function(node: ast.FunctionDef, content: str) -> TestAnalysis:
    """å€‹åˆ¥ãƒ†ã‚¹ãƒˆé–¢æ•°ã®åˆ†æ"""
    # ãƒ†ã‚¹ãƒˆé–¢æ•°ã®ã‚½ãƒ¼ã‚¹æŠ½å‡º
    lines = content.split('\n')
    start_line = node.lineno - 1
    end_line = _find_function_end(node, lines)
    test_source = '\n'.join(lines[start_line:end_line])

    # Mockä½¿ç”¨å›æ•°ã‚«ã‚¦ãƒ³ãƒˆ
    mock_count = len(re.findall(r'Mock|mock|patch', test_source))

    # ã‚«ãƒ†ã‚´ãƒªåˆ†é¡
    category = _categorize_test(node.name, test_source)

    # ä¾¡å€¤è©•ä¾¡
    value_score = _evaluate_test_value(test_source, category, mock_count)

    # ä¿æŒåˆ¤æ–­
    keep_decision = _decide_keep_or_delete(category, value_score, mock_count)

    return TestAnalysis(
        name=node.name,
        line_count=end_line - start_line,
        mock_count=mock_count,
        category=category,
        value_score=value_score,
        keep_decision=keep_decision
    )

def generate_analysis_report(analyses: List[TestAnalysis]) -> str:
    """åˆ†æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"""
    keep_tests = [a for a in analyses if a.keep_decision == "keep"]
    refactor_tests = [a for a in analyses if a.keep_decision == "refactor"]
    delete_tests = [a for a in analyses if a.keep_decision == "delete"]

    total_lines = sum(a.line_count for a in analyses)
    keep_lines = sum(a.line_count for a in keep_tests)

    report = f"""
# test_fantia.py åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

## æ¦‚è¦
- ç·ãƒ†ã‚¹ãƒˆæ•°: {len(analyses)}
- ç·è¡Œæ•°: {total_lines}
- ä¿æŒå¯¾è±¡: {len(keep_tests)} ãƒ†ã‚¹ãƒˆ ({keep_lines} è¡Œ)
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿å¯¾è±¡: {len(refactor_tests)} ãƒ†ã‚¹ãƒˆ
- å‰Šé™¤å¯¾è±¡: {len(delete_tests)} ãƒ†ã‚¹ãƒˆ

## ã‚«ãƒ†ã‚´ãƒªåˆ¥åˆ†æ
{_category_summary(analyses)}

## å‰Šé™¤å¯¾è±¡ãƒ†ã‚¹ãƒˆè©³ç´°
{_format_test_list(delete_tests)}

## ãƒªãƒ•ã‚¡ã‚¯ã‚¿å¯¾è±¡ãƒ†ã‚¹ãƒˆè©³ç´°
{_format_test_list(refactor_tests)}

## ä¿æŒå¯¾è±¡ãƒ†ã‚¹ãƒˆè©³ç´°
{_format_test_list(keep_tests)}
"""
    return report

if __name__ == "__main__":
    analyses = analyze_fantia_tests()
    report = generate_analysis_report(analyses)

    with open("fantia_test_analysis.md", "w") as f:
        f.write(report)

    print("âœ… åˆ†æå®Œäº†: fantia_test_analysis.md")
```

**æˆåŠŸåŸºæº–**:

- [ ] å…¨ãƒ†ã‚¹ãƒˆé–¢æ•°ã®ä¾¡å€¤è©•ä¾¡å®Œäº†
- [ ] å‰Šé™¤/ä¿æŒ/ãƒªãƒ•ã‚¡ã‚¯ã‚¿åˆ¤æ–­ç¢ºå®š
- [ ] è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

### âœ… Task B2: ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆæŠ½å‡ºãƒ»ç§»è¡Œ

**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜
**æ‰€è¦æ™‚é–“**: 6-8æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:

```python
# tests/unit/modules/fantia/test_domain.py
"""Fantiaãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ

ä»–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¸ã®ä¾å­˜ãƒ»å‚ç…§ã¯ä¸€åˆ‡ç¦æ­¢
moro.modules.fantia.* ã®ã¿importè¨±å¯
"""
import pytest
from datetime import datetime
from moro.modules.fantia.domain import (
    FantiaPost, FantiaCreator, PostStatus, ContentType
)
from tests.factories.fantia_factories import FantiaPostFactory, FantiaCreatorFactory

class TestFantiaPost:
    """FantiaPost ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ†ã‚¹ãƒˆ"""

    def test_post_creation_with_valid_data(self):
        """æœ‰åŠ¹ãƒ‡ãƒ¼ã‚¿ã§ã®æŠ•ç¨¿ä½œæˆãƒ†ã‚¹ãƒˆ"""
        post = FantiaPostFactory.create(
            title="ãƒ†ã‚¹ãƒˆæŠ•ç¨¿",
            status=PostStatus.PUBLISHED
        )

        assert post.title == "ãƒ†ã‚¹ãƒˆæŠ•ç¨¿"
        assert post.status == PostStatus.PUBLISHED
        assert isinstance(post.created_at, datetime)

    def test_post_validation_title_required(self):
        """ã‚¿ã‚¤ãƒˆãƒ«å¿…é ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ"""
        with pytest.raises(ValueError, match="Title is required"):
            FantiaPost(title="", content="test", creator_id=123)

    def test_post_content_type_validation(self):
        """ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ—ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ"""
        post = FantiaPostFactory.create(content_type=ContentType.BLOG)
        assert post.content_type == ContentType.BLOG

        with pytest.raises(ValueError):
            FantiaPost(title="test", content="test", content_type="invalid")

class TestFantiaCreator:
    """FantiaCreator ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ†ã‚¹ãƒˆ"""

    def test_creator_creation(self):
        """ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ä½œæˆãƒ†ã‚¹ãƒˆ"""
        creator = FantiaCreatorFactory.create(name="ãƒ†ã‚¹ãƒˆã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼")

        assert creator.name == "ãƒ†ã‚¹ãƒˆã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼"
        assert creator.id > 0

    def test_creator_name_validation(self):
        """ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼åãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ"""
        with pytest.raises(ValueError):
            FantiaCreator(name="", id=123)

class TestDomainValidations:
    """ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ãƒ†ã‚¹ãƒˆ"""

    def test_validate_post_type_blog(self):
        """ãƒ–ãƒ­ã‚°æŠ•ç¨¿ã‚¿ã‚¤ãƒ—ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ"""
        from moro.modules.fantia.domain import validate_post_type

        assert validate_post_type("blog") is True
        assert validate_post_type("normal") is True
        assert validate_post_type("invalid") is False

    def test_extract_post_metadata_success(self):
        """æŠ•ç¨¿ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºãƒ†ã‚¹ãƒˆ"""
        from moro.modules.fantia.domain import extract_post_metadata

        test_data = {
            "id": 123,
            "title": "ãƒ†ã‚¹ãƒˆ",
            "converted_at": "2023-01-01T00:00:00Z"
        }

        metadata = extract_post_metadata(test_data)
        assert metadata.id == 123
        assert metadata.title == "ãƒ†ã‚¹ãƒˆ"
```

```python
# tests/factories/fantia_factories.pyæ›´æ–°
"""Fantiaãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å°‚ç”¨Factory - type hintså®Œå…¨å¯¾å¿œ"""

from datetime import datetime
from polyfactory import BaseFactory
from moro.modules.fantia.domain import FantiaPost, FantiaCreator, PostStatus, ContentType

class FantiaPostFactory(BaseFactory[FantiaPost]):
    __model__ = FantiaPost

    @classmethod
    def title(cls) -> str:
        return "ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã‚¿ã‚¤ãƒˆãƒ«"

    @classmethod
    def creator_id(cls) -> int:
        return 12345

    @classmethod
    def status(cls) -> PostStatus:
        return PostStatus.PUBLISHED

    @classmethod
    def content_type(cls) -> ContentType:
        return ContentType.NORMAL

    @classmethod
    def created_at(cls) -> datetime:
        return datetime.now()

class FantiaCreatorFactory(BaseFactory[FantiaCreator]):
    __model__ = FantiaCreator

    @classmethod
    def name(cls) -> str:
        return "ãƒ†ã‚¹ãƒˆã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼"

    @classmethod
    def id(cls) -> int:
        return 12345
```

**æˆåŠŸåŸºæº–**:

- [ ] ç´”ç²‹ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯50-80è¡ŒæŠ½å‡º
- [ ] å¤–éƒ¨ä¾å­˜ã‚¼ãƒ­ç¢ºèª
- [ ] polyfactoryæ­£å¸¸å‹•ä½œç¢ºèª
- [ ] pytest tests/unit/modules/fantia/test_domain.py å˜ç‹¬å®Ÿè¡ŒæˆåŠŸ

### âœ… Task B3: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆåˆ†é›¢

**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜
**æ‰€è¦æ™‚é–“**: 8-10æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:

```python
# tests/unit/modules/fantia/test_usecases.py
"""Fantiaãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ

EPGStation/TODOç­‰ã®ä»–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å‚ç…§ç¦æ­¢
moro.modules.fantia.* ã®ã¿importè¨±å¯
"""
import pytest
from unittest.mock import Mock, MagicMock
from pathlib import Path

from moro.modules.fantia.usecases import (
    FantiaSavePostUseCase, FantiaDownloadUseCase
)
from moro.modules.fantia.domain import FantiaPost, FantiaPostRepository
from moro.modules.fantia.infrastructure import FantiaFileDownloader
from moro.modules.common import CommonConfig
from tests.factories.fantia_factories import FantiaPostFactory
from tests.factories.common_factories import CommonConfigFactory

class TestFantiaSavePostUseCase:
    """FantiaSavePostUseCase å˜ä½“ãƒ†ã‚¹ãƒˆ"""

    @pytest.fixture
    def mock_repository(self) -> Mock:
        """Repositoryã®Mock"""
        return Mock(spec=FantiaPostRepository)

    @pytest.fixture
    def mock_downloader(self) -> Mock:
        """FileDownloaderã®Mock"""
        return Mock(spec=FantiaFileDownloader)

    @pytest.fixture
    def usecase(self, mock_repository, mock_downloader) -> FantiaSavePostUseCase:
        """ãƒ†ã‚¹ãƒˆå¯¾è±¡UseCase"""
        config = CommonConfigFactory.create()
        return FantiaSavePostUseCase(
            repository=mock_repository,
            downloader=mock_downloader,
            config=config
        )

    def test_execute_basic_post_save(self, usecase, mock_repository):
        """åŸºæœ¬çš„ãªæŠ•ç¨¿ä¿å­˜ãƒ†ã‚¹ãƒˆ"""
        # Given
        post_id = "test_post_123"
        test_post = FantiaPostFactory.create(id=post_id)
        mock_repository.get.return_value = test_post
        mock_repository.save.return_value = True

        # When
        result = usecase.execute(post_id)

        # Then
        assert result.success is True
        mock_repository.get.assert_called_once_with(post_id)
        mock_repository.save.assert_called_once_with(test_post)

    def test_execute_post_not_found(self, usecase, mock_repository):
        """æŠ•ç¨¿ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®ãƒ†ã‚¹ãƒˆ"""
        # Given
        post_id = "nonexistent_post"
        mock_repository.get.return_value = None

        # When
        result = usecase.execute(post_id)

        # Then
        assert result.success is False
        assert "Post not found" in result.error_message

    def test_execute_repository_error(self, usecase, mock_repository):
        """Repositoryä¾‹å¤–å‡¦ç†ãƒ†ã‚¹ãƒˆ"""
        # Given
        post_id = "test_post_123"
        mock_repository.get.side_effect = Exception("Database error")

        # When
        result = usecase.execute(post_id)

        # Then
        assert result.success is False
        assert "Database error" in result.error_message

class TestFantiaDownloadUseCase:
    """FantiaDownloadUseCase å˜ä½“ãƒ†ã‚¹ãƒˆ"""

    @pytest.fixture
    def mock_repository(self) -> Mock:
        return Mock(spec=FantiaPostRepository)

    @pytest.fixture
    def mock_downloader(self) -> Mock:
        return Mock(spec=FantiaFileDownloader)

    @pytest.fixture
    def usecase(self, mock_repository, mock_downloader) -> FantiaDownloadUseCase:
        config = CommonConfigFactory.create()
        return FantiaDownloadUseCase(
            repository=mock_repository,
            downloader=mock_downloader,
            config=config
        )

    def test_download_with_valid_post(self, usecase, mock_repository, mock_downloader):
        """æœ‰åŠ¹æŠ•ç¨¿ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ"""
        # Given
        post = FantiaPostFactory.create()
        download_path = Path("/tmp/test_download")
        mock_repository.get.return_value = post
        mock_downloader.download_all.return_value = True

        # When
        result = usecase.download(post.id, download_path)

        # Then
        assert result.success is True
        mock_downloader.download_all.assert_called_once()

    def test_download_file_error(self, usecase, mock_repository, mock_downloader):
        """ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ"""
        # Given
        post = FantiaPostFactory.create()
        download_path = Path("/tmp/test_download")
        mock_repository.get.return_value = post
        mock_downloader.download_all.side_effect = IOError("Network error")

        # When
        result = usecase.download(post.id, download_path)

        # Then
        assert result.success is False
        assert "Network error" in result.error_message
```

**æˆåŠŸåŸºæº–**:

- [ ] UseCase100-150è¡ŒæŠ½å‡º
- [ ] Mockä½¿ç”¨ã‚’å¢ƒç•Œã«é™å®š
- [ ] å¤–éƒ¨ä¾å­˜é©åˆ‡åˆ†é›¢
- [ ] å˜ç‹¬å®Ÿè¡ŒæˆåŠŸç¢ºèª

### âœ… Task B4: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãƒ†ã‚¹ãƒˆåˆ†é›¢

**å„ªå…ˆåº¦**: ğŸŸ¡ é«˜
**æ‰€è¦æ™‚é–“**: 6-8æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:

```python
# tests/unit/modules/fantia/test_infrastructure.py
"""Fantiaãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹ã‚¤ãƒ³ãƒ•ãƒ©ãƒ†ã‚¹ãƒˆ

å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æºéƒ¨åˆ†ã®å˜ä½“ãƒ†ã‚¹ãƒˆ
Mockä½¿ç”¨ã«ã‚ˆã‚‹å¤–éƒ¨ä¾å­˜åˆ†é›¢
"""
import pytest
from unittest.mock import Mock, patch, MagicMock
import httpx

from moro.modules.fantia.infrastructure import (
    FantiaPostRepository, FantiaClient, FantiaFileDownloader
)
from moro.modules.fantia.domain import FantiaPost
from moro.modules.common import CommonConfig
from tests.factories.fantia_factories import FantiaPostFactory
from tests.factories.common_factories import CommonConfigFactory

class TestFantiaPostRepository:
    """FantiaPostRepository å˜ä½“ãƒ†ã‚¹ãƒˆ"""

    @pytest.fixture
    def mock_client(self) -> Mock:
        """FantiaClient Mock"""
        return Mock(spec=FantiaClient)

    @pytest.fixture
    def repository(self, mock_client) -> FantiaPostRepository:
        """ãƒ†ã‚¹ãƒˆå¯¾è±¡Repository"""
        config = CommonConfigFactory.create()
        return FantiaPostRepository(client=mock_client, config=config)

    def test_get_post_success(self, repository, mock_client):
        """æŠ•ç¨¿å–å¾—æˆåŠŸãƒ†ã‚¹ãƒˆ"""
        # Given
        post_id = "123"
        test_data = {
            "id": 123,
            "title": "ãƒ†ã‚¹ãƒˆæŠ•ç¨¿",
            "content": "ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„"
        }
        mock_client.get_post.return_value = test_data

        # When
        result = repository.get(post_id)

        # Then
        assert result is not None
        assert result.id == 123
        assert result.title == "ãƒ†ã‚¹ãƒˆæŠ•ç¨¿"
        mock_client.get_post.assert_called_once_with(post_id)

    def test_get_post_not_found(self, repository, mock_client):
        """æŠ•ç¨¿ãŒå­˜åœ¨ã—ãªã„å ´åˆã®ãƒ†ã‚¹ãƒˆ"""
        # Given
        post_id = "nonexistent"
        mock_client.get_post.return_value = None

        # When
        result = repository.get(post_id)

        # Then
        assert result is None

    def test_save_post_success(self, repository, mock_client):
        """æŠ•ç¨¿ä¿å­˜æˆåŠŸãƒ†ã‚¹ãƒˆ"""
        # Given
        post = FantiaPostFactory.create()
        mock_client.save_post_data.return_value = True

        # When
        result = repository.save(post)

        # Then
        assert result is True
        mock_client.save_post_data.assert_called_once()

class TestFantiaClient:
    """FantiaClient å˜ä½“ãƒ†ã‚¹ãƒˆ"""

    @pytest.fixture
    def client(self) -> FantiaClient:
        """ãƒ†ã‚¹ãƒˆå¯¾è±¡Client"""
        config = CommonConfigFactory.create()
        return FantiaClient(config=config)

    @patch('httpx.get')
    def test_get_post_http_success(self, mock_get, client):
        """HTTPæŠ•ç¨¿å–å¾—æˆåŠŸãƒ†ã‚¹ãƒˆ"""
        # Given
        mock_response = Mock()
        mock_response.status_code = 200
        mock_response.json.return_value = {
            "id": 123,
            "title": "HTTPãƒ†ã‚¹ãƒˆæŠ•ç¨¿"
        }
        mock_get.return_value = mock_response

        # When
        result = client.get_post("123")

        # Then
        assert result["id"] == 123
        assert result["title"] == "HTTPãƒ†ã‚¹ãƒˆæŠ•ç¨¿"

    @patch('httpx.get')
    def test_get_post_http_error(self, mock_get, client):
        """HTTPä¾‹å¤–å‡¦ç†ãƒ†ã‚¹ãƒˆ"""
        # Given
        mock_get.side_effect = httpx.RequestError("Network error")

        # When
        result = client.get_post("123")

        # Then
        assert result is None

    @patch('httpx.get')
    def test_get_post_404_error(self, mock_get, client):
        """404ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ†ã‚¹ãƒˆ"""
        # Given
        mock_response = Mock()
        mock_response.status_code = 404
        mock_get.return_value = mock_response

        # When
        result = client.get_post("nonexistent")

        # Then
        assert result is None

class TestFantiaFileDownloader:
    """FantiaFileDownloader å˜ä½“ãƒ†ã‚¹ãƒˆ"""

    @pytest.fixture
    def downloader(self) -> FantiaFileDownloader:
        """ãƒ†ã‚¹ãƒˆå¯¾è±¡Downloader"""
        config = CommonConfigFactory.create()
        return FantiaFileDownloader(config=config)

    @patch('httpx.get')
    @patch('pathlib.Path.write_bytes')
    def test_download_file_success(self, mock_write, mock_get, downloader):
        """ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æˆåŠŸãƒ†ã‚¹ãƒˆ"""
        # Given
        mock_response = Mock()
        mock_response.status_code = 200
        mock_response.content = b"test file content"
        mock_get.return_value = mock_response

        # When
        result = downloader.download_file("http://test.com/file.jpg", "/tmp/file.jpg")

        # Then
        assert result is True
        mock_write.assert_called_once_with(b"test file content")

    @patch('httpx.get')
    def test_download_file_network_error(self, mock_get, downloader):
        """ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ†ã‚¹ãƒˆ"""
        # Given
        mock_get.side_effect = httpx.RequestError("Connection failed")

        # When
        result = downloader.download_file("http://test.com/file.jpg", "/tmp/file.jpg")

        # Then
        assert result is False
```

**æˆåŠŸåŸºæº–**:

- [ ] Infrastructure80-120è¡ŒæŠ½å‡º
- [ ] HTTPé€šä¿¡MockåŒ–
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ MockåŒ–
- [ ] ä¾‹å¤–å‡¦ç†ç¶²ç¾…ç¢ºèª

### âœ… Task B5: çµ±åˆãƒ»E2Eãƒ†ã‚¹ãƒˆæœ€å°åŒ–

**å„ªå…ˆåº¦**: ğŸŸ¡ é«˜
**æ‰€è¦æ™‚é–“**: 4-6æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:

```python
# tests/integration/external_systems/test_fantia_api_integration.py
"""Fantia APIå®Ÿçµ±åˆãƒ†ã‚¹ãƒˆ - æœ€å°é™

å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã«ã‚ˆã‚‹çµ±åˆãƒ†ã‚¹ãƒˆ
æœ¬å½“ã«å¿…è¦ãªçµ±åˆãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè£…
"""
import pytest
from moro.modules.fantia.infrastructure import FantiaClient
from moro.modules.common import CommonConfig

@pytest.mark.integration
class TestFantiaAPIIntegration:
    """Fantia APIçµ±åˆãƒ†ã‚¹ãƒˆ"""

    @pytest.fixture
    def client(self) -> FantiaClient:
        """å®Ÿéš›ã®FantiaClient"""
        config = CommonConfig(
            user_data_dir="/tmp/test_data",
            user_cache_dir="/tmp/test_cache"
        )
        return FantiaClient(config=config)

    @pytest.mark.slow
    def test_real_api_connection_health(self, client):
        """å®ŸAPIæ¥ç¶šãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯"""
        # å®Ÿéš›ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®ã¿
        result = client.check_api_health()
        assert result is True

    @pytest.mark.slow
    def test_authentication_flow(self, client):
        """èªè¨¼ãƒ•ãƒ­ãƒ¼çµ±åˆãƒ†ã‚¹ãƒˆ"""
        # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®çµ±åˆç¢ºèªã®ã¿
        session_valid = client.validate_session()
        # èªè¨¼ãŒç„¡åŠ¹ã§ã‚‚ãƒ†ã‚¹ãƒˆå¤±æ•—ã«ã—ãªã„ï¼ˆç’°å¢ƒä¾å­˜ã®ãŸã‚ï¼‰
        assert session_valid in [True, False]
```

```python
# tests/e2e/workflows/test_fantia_download_workflow.py
"""Fantiaå®Œå…¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ E2E

æœ€å°é™ã®ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªã®ã¿
"""
import pytest
from pathlib import Path
from click.testing import CliRunner

from moro.cli.fantia import download_post

@pytest.mark.e2e
class TestFantiaDownloadWorkflow:
    """Fantiaå®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ"""

    @pytest.fixture
    def runner(self) -> CliRunner:
        """CLIå®Ÿè¡Œç’°å¢ƒ"""
        return CliRunner()

    @pytest.fixture
    def temp_download_dir(self, tmp_path) -> Path:
        """ä¸€æ™‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª"""
        download_dir = tmp_path / "fantia_downloads"
        download_dir.mkdir()
        return download_dir

    @pytest.mark.slow
    def test_complete_download_workflow(self, runner, temp_download_dir):
        """å®Œå…¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼"""
        # ãƒ†ã‚¹ãƒˆç”¨ã®å…¬é–‹æŠ•ç¨¿IDï¼ˆå®Ÿéš›ã®ãƒ†ã‚¹ãƒˆå¯èƒ½ãªIDï¼‰
        test_post_id = "test_public_post_123"

        # CLIçµŒç”±ã§ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
        result = runner.invoke(download_post, [
            test_post_id,
            "--output", str(temp_download_dir),
            "--test-mode"  # ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ãƒ•ãƒ©ã‚°
        ])

        # æˆåŠŸç¢ºèªï¼ˆç’°å¢ƒã«ã‚ˆã£ã¦ã‚¹ã‚­ãƒƒãƒ—å¯èƒ½ï¼‰
        if result.exit_code == 0:
            assert (temp_download_dir / test_post_id).exists()
        else:
            pytest.skip("ç’°å¢ƒä¾å­˜ãƒ†ã‚¹ãƒˆ: APIèªè¨¼ãªã—")
```

**æˆåŠŸåŸºæº–**:

- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ30-50è¡Œã«å‰Šæ¸›
- [ ] E2Eãƒ†ã‚¹ãƒˆ20-30è¡Œã«å‰Šæ¸›
- [ ] ç’°å¢ƒä¾å­˜ãƒ†ã‚¹ãƒˆé©åˆ‡SkipåŒ–
- [ ] å®Ÿè¡Œæ™‚é–“2åˆ†ä»¥å†…ç¢ºèª

### âœ… Task B6: ä¸è¦ãƒ†ã‚¹ãƒˆå‰Šé™¤ãƒ»ç§»è¡Œå®Œäº†

**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜
**æ‰€è¦æ™‚é–“**: 2-3æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:

```bash
# æ—¢å­˜test_fantia.pyå®Œå…¨å‰Šé™¤
rm tests/modules/test_fantia.py

# æ–°æ§‹é€ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç¢ºèª
pytest tests/unit/modules/fantia/ -v
pytest tests/integration/external_systems/test_fantia_api_integration.py -m integration
pytest tests/e2e/workflows/test_fantia_download_workflow.py -m e2e

# ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹æ€§ç¢ºèª
import-linter --config .importlinter.toml
python scripts/validate_test_structure.py

# ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
pytest --cov=src/moro/modules/fantia tests/unit/modules/fantia/
```

**å‰Šé™¤å¯¾è±¡**:

- è¤‡æ•°è²¬å‹™æ··åœ¨ãƒ†ã‚¹ãƒˆ (æ¨å®š400-500è¡Œ)
- éåº¦Mockä½¿ç”¨ãƒ†ã‚¹ãƒˆ (æ¨å®š200-300è¡Œ)
- é‡è¤‡æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ (æ¨å®š100-200è¡Œ)
- æ›–æ˜§ä¾¡å€¤ãƒ†ã‚¹ãƒˆ (æ¨å®š100-200è¡Œ)

**æˆåŠŸåŸºæº–**:

- [ ] test_fantia.py(1,189è¡Œ)å®Œå…¨å‰Šé™¤
- [ ] æ–°ãƒ†ã‚¹ãƒˆ280-400è¡Œã§é«˜å“è³ªåŒ–
- [ ] å…¨æ–°ãƒ†ã‚¹ãƒˆæ­£å¸¸å®Ÿè¡Œç¢ºèª
- [ ] ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹æ€§100%é”æˆ

## ğŸ“‹ Phase C: å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ¨™æº–åŒ– (Week 5-8)

### ğŸ¯ ç›®æ¨™

å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ–°æ§‹é€ é©ç”¨ãƒ»å“è³ªå®‰å®šåŒ–ãƒ»è‡ªå‹•åŒ–å®Œæˆ

### âœ… Task C1: EPGStationãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ æ”¹å–„

**å„ªå…ˆåº¦**: ğŸŸ¡ é«˜
**æ‰€è¦æ™‚é–“**: 8-10æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:

```python
# tests/unit/modules/epgstation/test_domain.pyä½œæˆ
"""EPGStationãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ"""
import pytest
from datetime import datetime
from moro.modules.epgstation.domain import RecordingData, VideoFile, VideoFileType
from tests.factories.epgstation_factories import RecordingDataFactory, VideoFileFactory

class TestRecordingData:
    """RecordingData ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ†ã‚¹ãƒˆ"""

    def test_format_start_time_success(self):
        """é–‹å§‹æ™‚åˆ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ†ã‚¹ãƒˆ"""
        recording = RecordingDataFactory.create(start_at=1691683200000)
        formatted = recording.formatted_start_time
        assert "2023-08-10" in formatted

    def test_calculate_duration_minutes(self):
        """éŒ²ç”»æ™‚é–“è¨ˆç®—ãƒ†ã‚¹ãƒˆ"""
        recording = RecordingDataFactory.create(
            start_at=1691683200000,  # 2023-08-10 20:00
            end_at=1691686800000     # 2023-08-10 21:00
        )
        assert recording.duration_minutes == 60

class TestVideoFile:
    """VideoFile ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ†ã‚¹ãƒˆ"""

    def test_format_file_size_appropriate_unit(self):
        """ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºå˜ä½ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ†ã‚¹ãƒˆ"""
        video = VideoFileFactory.create(size=1500000000)  # 1.5GB
        assert "1.4 GB" in video.formatted_size

    def test_video_file_type_validation(self):
        """ãƒ“ãƒ‡ã‚ªãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ"""
        video = VideoFileFactory.create(type=VideoFileType.TS)
        assert video.type == VideoFileType.TS
```

```python
# tests/factories/epgstation_factories.pyä½œæˆ
from polyfactory import BaseFactory
from moro.modules.epgstation.domain import RecordingData, VideoFile, VideoFileType

class RecordingDataFactory(BaseFactory[RecordingData]):
    __model__ = RecordingData

    @classmethod
    def name(cls) -> str:
        return "ãƒ†ã‚¹ãƒˆéŒ²ç”»ç•ªçµ„"

    @classmethod
    def start_at(cls) -> int:
        return 1691683200000

    @classmethod
    def end_at(cls) -> int:
        return 1691686800000

class VideoFileFactory(BaseFactory[VideoFile]):
    __model__ = VideoFile

    @classmethod
    def filename(cls) -> str:
        return "test_video.ts"

    @classmethod
    def size(cls) -> int:
        return 1000000000

    @classmethod
    def type(cls) -> VideoFileType:
        return VideoFileType.TS
```

**æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«çµ±åˆ**:

- `tests/modules/epgstation/test_epgs_*.py` â†’ æ–°æ§‹é€ ç§»è¡Œ
- é‡è¤‡ãƒ†ã‚¹ãƒˆå‰Šé™¤ãƒ»è²¬å‹™åˆ†é›¢
- å‘½åè¦å‰‡çµ±ä¸€

**æˆåŠŸåŸºæº–**:

- [ ] EPGStationæ–°æ§‹é€ ç§»è¡Œå®Œäº†
- [ ] æ—¢å­˜ãƒ†ã‚¹ãƒˆå“è³ªå‘ä¸Š
- [ ] å®Ÿè¡Œæ™‚é–“2ç§’ä»¥å†…ç¢ºèª

### âœ… Task C2: TODOãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æœ€é©åŒ–

**å„ªå…ˆåº¦**: ğŸŸ¢ ä¸­
**æ‰€è¦æ™‚é–“**: 4-6æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:
TODOãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯æ—¢ã«è‰¯å¥½ãªæ§‹é€ ã®ãŸã‚ã€å¾®èª¿æ•´ã®ã¿å®Ÿæ–½

```python
# tests/unit/modules/todo/test_domain.py (æ—¢å­˜æ”¹å–„)
# æ—¢å­˜ã®é«˜å“è³ªãƒ†ã‚¹ãƒˆã‚’æ–°æ§‹é€ ã«é…ç½®
# æœ€å°é™ã®èª¿æ•´ã®ã¿

# tests/factories/todo_factories.pyä½œæˆ
from polyfactory import BaseFactory
from moro.modules.todo.domain import Todo, TodoID, Priority

class TodoFactory(BaseFactory[Todo]):
    __model__ = Todo

    @classmethod
    def title(cls) -> str:
        return "ãƒ†ã‚¹ãƒˆã‚¿ã‚¹ã‚¯"

    @classmethod
    def priority(cls) -> Priority:
        return Priority.MEDIUM

class TodoIDFactory(BaseFactory[TodoID]):
    __model__ = TodoID
```

**æˆåŠŸåŸºæº–**:

- [ ] TODOæ–°æ§‹é€ é…ç½®å®Œäº†
- [ ] polyfactoryå°å…¥å®Œäº†
- [ ] æ—¢å­˜ãƒ†ã‚¹ãƒˆå“è³ªç¶­æŒ

### âœ… Task C3: CLIå±¤çµ±åˆãƒ†ã‚¹ãƒˆæœ€é©åŒ–

**å„ªå…ˆåº¦**: ğŸŸ¡ é«˜
**æ‰€è¦æ™‚é–“**: 6-8æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:

```python
# tests/unit/cli/test_epgstation.py (æ—¢å­˜æ”¹å–„)
"""EPGStation CLIå˜ä½“ãƒ†ã‚¹ãƒˆ - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆå¢ƒç•Œã®ã¿ãƒ†ã‚¹ãƒˆ"""
import pytest
from click.testing import CliRunner
from unittest.mock import Mock, patch

from moro.cli.epgstation import list_recordings, JsonFormatter, TableFormatter
from tests.factories.epgstation_factories import RecordingDataFactory

class TestEPGStationCLI:
    """EPGStation CLIå˜ä½“ãƒ†ã‚¹ãƒˆ"""

    @pytest.fixture
    def runner(self) -> CliRunner:
        return CliRunner()

    @patch('moro.cli.epgstation.create_injector')
    def test_list_recordings_table_format(self, mock_injector, runner):
        """ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼å‡ºåŠ›ãƒ†ã‚¹ãƒˆ"""
        # Given
        test_recordings = [RecordingDataFactory.create()]
        mock_usecase = Mock()
        mock_usecase.execute.return_value = test_recordings
        mock_injector.return_value.get.return_value = mock_usecase

        # When
        result = runner.invoke(list_recordings, ['--format', 'table'])

        # Then
        assert result.exit_code == 0
        assert "ãƒ†ã‚¹ãƒˆéŒ²ç”»ç•ªçµ„" in result.output

class TestFormatters:
    """Formatterå˜ä½“ãƒ†ã‚¹ãƒˆ"""

    def test_table_formatter_single_recording(self):
        """ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼å˜ä½“ãƒ†ã‚¹ãƒˆ"""
        formatter = TableFormatter()
        recordings = [RecordingDataFactory.create()]

        result = formatter.format(recordings)

        assert "ãƒ†ã‚¹ãƒˆéŒ²ç”»ç•ªçµ„" in result
        assert "â”Œ" in result  # ãƒ†ãƒ¼ãƒ–ãƒ«ç½«ç·šç¢ºèª
```

**æˆåŠŸåŸºæº–**:

- [ ] CLIå˜ä½“ãƒ†ã‚¹ãƒˆæœ€é©åŒ–å®Œäº†
- [ ] ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¢ƒç•Œãƒ†ã‚¹ãƒˆã«é›†ç´„
- [ ] å®Ÿè¡Œæ™‚é–“çŸ­ç¸®ç¢ºèª

### âœ… Task C4: å“è³ªè‡ªå‹•åŒ–ãƒ»ç›£è¦–å®Œæˆ

**å„ªå…ˆåº¦**: ğŸ”´ æœ€é«˜
**æ‰€è¦æ™‚é–“**: 6-8æ™‚é–“
**æ‹…å½“**: å®Ÿè£…è€…

**å®Ÿè£…å†…å®¹**:

```yaml
# .github/workflows/test-quality.yml
name: Test Quality Assurance

on: [push, pull_request]

jobs:
  module-independence:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          pip install uv
          uv sync --dev

      - name: Check module independence
        run: |
          uv run import-linter --config .importlinter.toml
          uv run python scripts/validate_test_structure.py

      - name: Run unit tests (parallel)
        run: |
          uv run pytest tests/unit/ -n auto --maxfail=1

      - name: Check test execution time
        run: |
          # å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«2ç§’ä»¥å†…ãƒã‚§ãƒƒã‚¯
          uv run pytest tests/unit/modules/epgstation/ --maxfail=1 --timeout=2
          uv run pytest tests/unit/modules/fantia/ --maxfail=1 --timeout=2
          uv run pytest tests/unit/modules/todo/ --maxfail=1 --timeout=2

  integration-tests:
    runs-on: ubuntu-latest
    needs: module-independence
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          pip install uv
          uv sync --dev

      - name: Run integration tests
        run: |
          uv run pytest tests/integration/ -m integration --timeout=30

  quality-metrics:
    runs-on: ubuntu-latest
    needs: [module-independence, integration-tests]
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          pip install uv
          uv sync --dev

      - name: Generate quality report
        run: |
          uv run python scripts/generate_quality_report.py

      - name: Upload quality report
        uses: actions/upload-artifact@v3
        with:
          name: quality-report
          path: quality_report.md
```

```python
# scripts/generate_quality_report.py
#!/usr/bin/env python3
"""ãƒ†ã‚¹ãƒˆå“è³ªãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"""

import subprocess
import json
from pathlib import Path
from typing import Dict, Any

def generate_quality_report() -> Dict[str, Any]:
    """å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"""

    # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“æ¸¬å®š
    unit_time = measure_test_time("tests/unit/")
    integration_time = measure_test_time("tests/integration/")
    e2e_time = measure_test_time("tests/e2e/")

    # ãƒ•ã‚¡ã‚¤ãƒ«æ•°ãƒ»è¡Œæ•°çµ±è¨ˆ
    file_stats = collect_file_statistics()

    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹æ€§ãƒã‚§ãƒƒã‚¯
    independence_result = check_module_independence()

    report = {
        "execution_times": {
            "unit_tests": unit_time,
            "integration_tests": integration_time,
            "e2e_tests": e2e_time,
            "total": unit_time + integration_time + e2e_time
        },
        "file_statistics": file_stats,
        "module_independence": independence_result,
        "quality_score": calculate_quality_score(unit_time, file_stats, independence_result)
    }

    generate_markdown_report(report)
    return report

def measure_test_time(test_path: str) -> float:
    """ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“æ¸¬å®š"""
    try:
        result = subprocess.run(
            ["uv", "run", "pytest", test_path, "--quiet", "--tb=no"],
            capture_output=True, text=True, timeout=300
        )
        # pytestå‡ºåŠ›ã‹ã‚‰å®Ÿè¡Œæ™‚é–“æŠ½å‡º
        output = result.stdout
        if "seconds" in output:
            import re
            match = re.search(r'(\d+\.?\d*) seconds', output)
            if match:
                return float(match.group(1))
    except Exception:
        pass
    return 0.0

def collect_file_statistics() -> Dict[str, Any]:
    """ãƒ•ã‚¡ã‚¤ãƒ«çµ±è¨ˆåé›†"""
    test_files = list(Path("tests").rglob("test_*.py"))

    total_files = len(test_files)
    total_lines = sum(len(f.read_text().splitlines()) for f in test_files)
    avg_lines = total_lines / total_files if total_files > 0 else 0

    return {
        "total_files": total_files,
        "total_lines": total_lines,
        "average_lines_per_file": round(avg_lines, 1)
    }

def check_module_independence() -> bool:
    """ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹æ€§ãƒã‚§ãƒƒã‚¯"""
    try:
        result = subprocess.run(
            ["uv", "run", "import-linter", "--config", ".importlinter.toml"],
            capture_output=True, text=True
        )
        return result.returncode == 0
    except Exception:
        return False

def calculate_quality_score(unit_time: float, file_stats: Dict, independence: bool) -> int:
    """å“è³ªã‚¹ã‚³ã‚¢è¨ˆç®— (0-100)"""
    score = 100

    # å®Ÿè¡Œæ™‚é–“ãƒšãƒŠãƒ«ãƒ†ã‚£
    if unit_time > 5:
        score -= min(20, (unit_time - 5) * 2)

    # ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒšãƒŠãƒ«ãƒ†ã‚£
    if file_stats["average_lines_per_file"] > 200:
        score -= min(15, (file_stats["average_lines_per_file"] - 200) / 10)

    # ç‹¬ç«‹æ€§ãƒšãƒŠãƒ«ãƒ†ã‚£
    if not independence:
        score -= 30

    return max(0, int(score))

def generate_markdown_report(report: Dict[str, Any]) -> None:
    """Markdownãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"""
    content = f"""# ãƒ†ã‚¹ãƒˆå“è³ªãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ“Š å®Ÿè¡Œæ™‚é–“ãƒ¡ãƒˆãƒªã‚¯ã‚¹
- **å˜ä½“ãƒ†ã‚¹ãƒˆ**: {report["execution_times"]["unit_tests"]:.2f}ç§’
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: {report["execution_times"]["integration_tests"]:.2f}ç§’
- **E2Eãƒ†ã‚¹ãƒˆ**: {report["execution_times"]["e2e_tests"]:.2f}ç§’
- **åˆè¨ˆå®Ÿè¡Œæ™‚é–“**: {report["execution_times"]["total"]:.2f}ç§’

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«çµ±è¨ˆ
- **ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: {report["file_statistics"]["total_files"]}
- **ç·è¡Œæ•°**: {report["file_statistics"]["total_lines"]}
- **å¹³å‡è¡Œæ•°/ãƒ•ã‚¡ã‚¤ãƒ«**: {report["file_statistics"]["average_lines_per_file"]}

## ğŸ”’ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç‹¬ç«‹æ€§
- **ç‹¬ç«‹æ€§ãƒã‚§ãƒƒã‚¯**: {"âœ… é©åˆ" if report["module_independence"] else "âŒ é•å"}

## ğŸ¯ å“è³ªã‚¹ã‚³ã‚¢
- **ç·åˆã‚¹ã‚³ã‚¢**: {report["quality_score"]}/100

### åŸºæº–
- 90-100: å„ªç§€
- 80-89: è‰¯å¥½
- 70-79: æ”¹å–„æ¨å¥¨
- 70æœªæº€: è¦æ”¹å–„
"""

    Path("quality_report.md").write_text(content)

if __name__ == "__main__":
    generate_quality_report()
    print("âœ… å“è³ªãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†: quality_report.md")
```

```toml
# .pre-commit-config.yamlæ›´æ–°
repos:
  - repo: local
    hooks:
      - id: import-linter
        name: Check module independence
        entry: uv run import-linter --config .importlinter.toml
        language: system
        pass_filenames: false

      - id: test-structure-validation
        name: Validate test structure
        entry: uv run python scripts/validate_test_structure.py
        language: system
        pass_filenames: false

      - id: unit-test-performance
        name: Check unit test performance
        entry: uv run pytest tests/unit/ --maxfail=1 --timeout=5 --quiet
        language: system
        pass_filenames: false
```

**æˆåŠŸåŸºæº–**:

- [ ] CI/CDå®Œå…¨è‡ªå‹•åŒ–
- [ ] å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹è‡ªå‹•åé›†
- [ ] pre-commit hookå‹•ä½œç¢ºèª
- [ ] å“è³ªãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ

## ğŸ–ï¸ æœ€çµ‚æˆæœç‰©ãƒ»å®Œäº†ç¢ºèª

### âœ… æ§‹é€ å“è³ªé”æˆç¢ºèª

**å®šé‡çš„æˆåŠŸåŸºæº–**:

- [ ] **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 31ãƒ•ã‚¡ã‚¤ãƒ« â†’ 15-20ãƒ•ã‚¡ã‚¤ãƒ«é”æˆ
- [ ] **ãƒ†ã‚¹ãƒˆæ•°**: 380ãƒ†ã‚¹ãƒˆ â†’ 200-250ãƒ†ã‚¹ãƒˆé”æˆ
- [ ] **å¹³å‡ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º**: 269è¡Œ â†’ 150è¡Œä»¥ä¸‹é”æˆ
- [ ] **Mockä½¿ç”¨å›æ•°**: 921å› â†’ 300å›ä»¥ä¸‹é”æˆ
- [ ] **å®Ÿè¡Œæ™‚é–“**: å…¨ãƒ†ã‚¹ãƒˆ5åˆ†ä»¥å†…é”æˆ

**å®šæ€§çš„æˆåŠŸåŸºæº–**:

- [ ] **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Œå…¨ç‹¬ç«‹**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ç‹¬å®Ÿè¡ŒæˆåŠŸ
- [ ] **æ–°è¦é–‹ç™ºè€…ç¿’å¾—**: ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ™‚é–“çŸ­ç¸®ç¢ºèª
- [ ] **æ©Ÿèƒ½è¿½åŠ å½±éŸ¿**: å½±éŸ¿ç¯„å›²5åˆ†ä»¥å†…ç‰¹å®šç¢ºèª
- [ ] **ä¿å®ˆå·¥æ•°**: ãƒ†ã‚¹ãƒˆä¿®æ­£å·¥æ•°60%å‰Šæ¸›é”æˆ

### âœ… å“è³ªè‡ªå‹•åŒ–ç¢ºèª

- [ ] **CI/CDçµ±åˆ**: å…¨è‡ªå‹•ãƒã‚§ãƒƒã‚¯ç¨¼åƒ
- [ ] **å“è³ªã‚²ãƒ¼ãƒˆ**: å“è³ªåŸºæº–é•åæ™‚è‡ªå‹•å¤±æ•—
- [ ] **ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**: å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹è‡ªå‹•åé›†
- [ ] **ç¶™ç¶šç›£è¦–**: pre-commit hookæ­£å¸¸å‹•ä½œ

### âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»çŸ¥è­˜ç§»è»¢

- [ ] **å®Ÿè£…ã‚¬ã‚¤ãƒ‰**: æ–°æ§‹é€ ã§ã®ãƒ†ã‚¹ãƒˆè¿½åŠ æ–¹æ³•æ–‡æ›¸åŒ–
- [ ] **å“è³ªåŸºæº–**: å“è³ªç¶­æŒãƒ«ãƒ¼ãƒ«æ˜æ–‡åŒ–
- [ ] **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: ã‚ˆãã‚ã‚‹å•é¡Œãƒ»è§£æ±ºæ³•æ•´ç†
- [ ] **å®Ÿè£…å®Œäº†å ±å‘Š**: å…¨ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã¸ã®å®Œäº†é€šçŸ¥

---

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Œäº†åŸºæº–**: ä¸Šè¨˜ã™ã¹ã¦ã®é …ç›®ãŒé”æˆã•ã‚Œã€æ–°ã—ã„ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã«ã‚ˆã‚‹æŒç¶šå¯èƒ½ãªé–‹ç™ºä½“åˆ¶ãŒç¢ºç«‹ã•ã‚Œã‚‹ã“ã¨

**ROIå®Ÿç¾**:

- **çŸ­æœŸ**: é–‹ç™ºé€Ÿåº¦å‘ä¸Šãƒ»ãƒ‡ãƒãƒƒã‚°æ™‚é–“çŸ­ç¸®
- **ä¸­æœŸ**: æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®å½±éŸ¿ç¯„å›²æ˜ç¢ºåŒ–ãƒ»ãƒ†ã‚¹ãƒˆä¿å®ˆå·¥æ•°å‰Šæ¸›
- **é•·æœŸ**: æŠ€è¡“è² å‚µè§£æ¶ˆãƒ»ãƒãƒ¼ãƒ ç”Ÿç”£æ€§å‘ä¸Šãƒ»å“è³ªå®‰å®šåŒ–
